import { Random } from '@local_modules/random.js'

const random = new Random()

/** @type {LevelData[]} */
export const levelDataList = [
  // 1
  {
    title: 'はじまり',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 0, 2, 2, 0, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 0, 2, 2, 0, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 1, 0, 0, 1, 0],
      [0, 2, 0, 0, 2, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 2
  {
    title: 'まがって　つないで',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 1, 2, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 2, 0, 0, 1, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 3
  {
    title: 'とおれなくても',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 0, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 1, 2, 2, 2, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 1, 0, 0, 0, 0],
      [0, 0, 2, 0, 0, 0],
      [0, 0, 0, 1, 0, 0],
      [0, 0, 0, 0, 2, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 4
  {
    title: 'まわりみち',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 1, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 0, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 1, 0],
      [0, 0, 0, 2, 0, 0],
      [0, 0, 1, 0, 0, 0],
      [0, 2, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 5
  {
    title: 'おして　ずらして',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 2, 2, 0],
      [0, 1, 2, 2, 2, 0],
      [0, 2, 2, 2, 1, 0],
      [0, 2, 2, 2, 2, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 2, 0, 0, 0, 0],
      [0, 0, 1, 2, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 1, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 6
  {
    title: 'バトンタッチ',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 0, 2, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 0, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 1, 0, 1, 0, 0],
      [0, 0, 2, 0, 2, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 7
  {
    title: 'こうさてん',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 0, 2, 2, 0, 0],
      [0, 2, 4, 4, 2, 0],
      [0, 2, 4, 4, 2, 0],
      [0, 0, 2, 2, 0, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 1, 0, 0, 2, 0],
      [0, 2, 0, 0, 1, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 8
  {
    title: 'こうさじごく',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 4, 4, 2, 0],
      [0, 2, 4, 4, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 1, 0, 0, 2, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 2, 0, 0, 1, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 9
  {
    title: 'しろくろ',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 3, 3, 3, 3, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 3, 3, 3, 3, 0],
      [0, 2, 2, 2, 2, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 1, 0, 0, 1, 0],
      [0, 2, 0, 0, 2, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 10
  {
    title: 'かわらないもの',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 3, 3, 0],
      [0, 2, 4, 5, 3, 0],
      [0, 2, 4, 5, 3, 0],
      [0, 2, 2, 3, 3, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 1, 2, 0, 0],
      [0, 0, 1, 2, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 11
  {
    title: 'おして　おして',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 3, 3, 2, 0],
      [0, 0, 2, 2, 0, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 1, 2, 0, 0],
      [0, 0, 2, 1, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 12
  {
    title: 'とおらなくても',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 4, 3, 3, 0],
      [0, 4, 2, 3, 3, 0],
      [0, 3, 3, 2, 4, 0],
      [0, 3, 3, 4, 2, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 2, 0, 0],
      [0, 0, 0, 0, 1, 0],
      [0, 2, 0, 0, 0, 0],
      [0, 0, 1, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 13
  {
    title: '今日の　ひとふでがき',
    ...randomLevel(),
  },
  // 14
  {
    title: 'ハートの　あらし',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [0, 2, 2, 2, 2, 0],
      [0, 2, 4, 2, 2, 0],
      [0, 2, 2, 4, 2, 0],
      [0, 2, 2, 2, 2, 0],
      [1, 0, 0, 0, 0, 1],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 2, 1, 1, 2, 0],
      [0, 1, 1, 1, 1, 0],
      [0, 1, 1, 1, 1, 0],
      [0, 2, 1, 1, 2, 0],
      [0, 0, 0, 0, 0, 0],
    ],
  },
  // 15
  {
    title: 'おす　おす　おす',
    tiles: [
      [1, 0, 0, 0, 0, 1],
      [3, 3, 3, 3, 3, 3],
      [3, 3, 0, 0, 3, 3],
      [0, 3, 3, 3, 3, 0],
      [0, 3, 3, 3, 3, 0],
      [0, 3, 0, 0, 3, 0],
    ],
    items: [
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0],
      [0, 0, 3, 0, 0, 0],
      [0, 1, 3, 0, 1, 0],
      [0, 2, 0, 0, 2, 0],
    ],
  },
  // 16
  {
    title: 'おしまい',
    tiles: [
      [1, 0, 3, 3, 0, 1],
      [0, 3, 2, 2, 3, 0],
      [3, 2, 2, 2, 2, 3],
      [3, 2, 2, 2, 2, 3],
      [0, 3, 2, 2, 3, 0],
      [1, 0, 3, 3, 0, 1],
    ],
    items: [
      [0, 0, 3, 3, 0, 0],
      [0, 3, 1, 1, 3, 0],
      [3, 1, 0, 0, 1, 3],
      [3, 2, 0, 0, 2, 3],
      [0, 3, 2, 2, 3, 0],
      [0, 0, 3, 3, 0, 0],
    ],
  },
]

function randomLevel() {
  random.seed = Random.getTodaySeed()

  const cols = 6
  const rows = 6
  const line = /** @type {Pos[]} */ ([])
  let tiles = /** @type {number[][]} */ ([])
  let items = /** @type {number[][]} */ ([])
  let dirs = [0, 1, 2, 3]

  const init = () => {
    line.splice(0)
    const y = random.nextInt(cols)
    const x = random.nextInt(rows)
    line.push({ x, y })
    dirs = [0, 1, 2, 3]
  }

  while (true) {
    init()

    main: while (line.length < rows * cols) {
      if (!dirs.length) init()

      const last = line[line.length - 1]
      const last2 = line[line.length - 2]
      let { x, y } = last

      const dir = dirs.splice(random.nextInt(dirs.length), 1)[0]
      if (dir === 0) x++
      else if (dir === 1) y++
      else if (dir === 2) x--
      else if (dir === 3) y--

      if (x < 0 || cols <= x || y < 0 || rows <= y) continue

      if (last2 && last2.x === x && last2.y === y) continue

      for (let i = 0; i < line.length; i++) {
        const prev = line[i - 1]
        const pos = line[i]
        const next = line[i + 1]
        if (pos.x === last.x && pos.y === last.y) {
          if (prev && prev.x === x && prev.y === y) continue main
          if (next && next.x === x && next.y === y) continue main
        }
      }

      line.push({ x, y })
      dirs = [0, 1, 2, 3]
    }

    tiles = Array.from({ length: 6 }).map(() => Array(6).fill(0))
    items = Array.from({ length: 6 }).map(() => Array(6).fill(0))

    for (const { x, y } of line) tiles[y][x] += 2
    if (tiles.flat().filter((n) => n === 4).length !== 4) continue

    const item1 = line[0]
    const item2 = line[line.length - 1]

    if (tiles[item1.y][item1.x] === 4) continue
    if (tiles[item2.y][item2.x] === 4) continue

    items[item1.y][item1.x] = 1
    items[item2.y][item2.x] = 1

    break
  }

  return {
    tiles,
    items,
  }
}
